(function(o,r){typeof exports=="object"&&typeof module<"u"?r(exports):typeof define=="function"&&define.amd?define(["exports"],r):(o=typeof globalThis<"u"?globalThis:o||self,r(o.Generalscroll={}))})(this,function(o){"use strict";class r{constructor(t,e={}){if(!t)throw new Error("Container element is required");this.container=typeof t=="string"?document.querySelector(t):t,this.options={speed:50,autoStart:!0,cloneNode:!0,direction:"vertical",...e},this.state={isScrolling:!1,isPaused:!1},this.plugins=[],this.animationFrame=null,this.observer=null,this.init()}init(){this.options.autoStart&&(this.setupContainer(),this.setupResizeObserver(),this.setupClones(),this.setupListeners(),this.runPlugins(),this.conditionalStart())}setupContainer(){const{direction:t}=this.options;this.container.style.overflow="hidden",this.container.style.display="flex",this.container.style.flexDirection=t==="vertical"?"column":"row"}setupClones(){if(!this.options.cloneNode||!this.shouldScroll())return;this.cleanClones(),[...this.container.children].forEach(e=>{const s=e.cloneNode(!0);s.dataset.clone="true",this.container.appendChild(s)})}setupListeners(){this.container.addEventListener("mouseenter",()=>this.pause()),this.container.addEventListener("mouseleave",()=>this.resume())}setupResizeObserver(){this.observer=new ResizeObserver(t=>{this.shouldScroll()?this.state.isScrolling||this.conditionalStart():this.state.isScrolling&&this.stop()}),this.observer.observe(this.container)}shouldScroll(){const{direction:t}=this.options,e=t==="vertical"?this.container.scrollHeight:this.container.scrollWidth,s=t==="vertical"?this.container.clientHeight:this.container.clientWidth;return console.log(e,s,e>s,"测试滚动距离"),e>s}conditionalStart(){this.shouldScroll()&&this.start()}runPlugins(){this.plugins.forEach(t=>t(this))}start(){if(this.state.isScrolling)return;this.state.isScrolling=!0;let t=performance.now(),e=0;const s=n=>{if(!this.state.isScrolling)return;if(!this.shouldScroll()){this.stop();return}const l=n-t;if(t=n,!this.state.isPaused){const{direction:a,speed:c}=this.options,h=a==="vertical"?"scrollTop":"scrollLeft",u=a==="vertical"?this.container.scrollHeight/2:this.container.scrollWidth/2;e+=c*l/16.667,e>=u&&(e-=u),this.container[h]=e%u}this.animationFrame=requestAnimationFrame(s)};this.animationFrame=requestAnimationFrame(s)}pause(){this.state.isPaused=!0}resume(){this.state.isPaused=!1}stop(){this.state.isScrolling=!1,cancelAnimationFrame(this.animationFrame)}destroy(){this.stop(),this.cleanClones(),this.observer&&this.observer.disconnect()}cleanClones(){this.container.querySelectorAll("[data-clone]").forEach(e=>e.remove())}use(t){return this.plugins.push(t),this}}const d=i=>{const t=()=>i.pause(),e=()=>i.resume();i.container.addEventListener("touchstart",t),i.container.addEventListener("touchend",e);const s=i.destroy.bind(i);i.destroy=()=>{i.container.removeEventListener("touchstart",t),i.container.removeEventListener("touchend",e),s()}},p=i=>{const t=new ResizeObserver(()=>{i.setupClones(),i.container[i.options.direction==="vertical"?"scrollTop":"scrollLeft"]=0});t.observe(i.container),i.observers.push(t)},f=i=>t=>{const e=t.start.bind(t);let s=0,n=0;t.start=function(){s=performance.now(),n=0,e()},t.animate,t.animate=()=>{if(!t.state.isScrolling||t.state.isPaused)return;const l=performance.now(),a=l-s;n=Math.min(n+a/1e3,1);const c=t.options.speed*i(n),h=t.options.direction==="vertical"?"scrollTop":"scrollLeft";t.container[h]+=c,s=l,t.animationFrame=requestAnimationFrame(t.animate)}};o.GeneralScroll=r,o.easingPlugin=f,o.resizePlugin=p,o.touchPlugin=d,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
